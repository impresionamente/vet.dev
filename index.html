<!doctype html>
const gridSize = 20;
const tile = canvas.width / gridSize;
let snake = [{x:8,y:8}];
let dir = {x:1,y:0};
let food = randomPos();
let running = true;
let score = 0;
const scoreEl = document.getElementById('score');
const playBtn = document.getElementById('playBtn');
const resetBtn = document.getElementById('resetBtn');
const speedInput = document.getElementById('speed');
let speed = Number(speedInput.value);


function randomPos(){return {x:Math.floor(Math.random()*gridSize),y:Math.floor(Math.random()*gridSize)}}


function draw(){
ctx.fillStyle = '#fff';
ctx.fillRect(0,0,canvas.width,canvas.height);
// food
ctx.fillStyle = '#000';
ctx.fillRect(food.x*tile,food.y*tile,tile,tile);
// snake
for(let s of snake){ctx.fillStyle='#000';ctx.fillRect(s.x*tile,s.y*tile,tile,tile)}
}


function step(){
if(!running) return;
const head = {x:(snake[0].x+dir.x+gridSize)%gridSize,y:(snake[0].y+dir.y+gridSize)%gridSize};
// collision self
if(snake.some(p=>p.x===head.x && p.y===head.y)){
snake = [{x:8,y:8}]; dir = {x:1,y:0}; food = randomPos(); score=0; updateScore(); draw(); return;
}
snake.unshift(head);
if(head.x===food.x && head.y===food.y){score++; food=randomPos(); updateScore()}else{snake.pop()}
draw();
}


function updateScore(){
const l = langSelect.value; scoreEl.textContent = (TRANSLATIONS[l].score||'Score')+': '+score;
}


document.addEventListener('keydown',(e)=>{
if(e.key==='ArrowUp' && dir.y!==1) {dir={x:0,y:-1}}
if(e.key==='ArrowDown' && dir.y!==-1){dir={x:0,y:1}}
if(e.key==='ArrowLeft' && dir.x!==1){dir={x:-1,y:0}}
if(e.key==='ArrowRight' && dir.x!==-1){dir={x:1,y:0}}
});


playBtn.addEventListener('click',()=>{
running = !running; playBtn.textContent = running ? (TRANSLATIONS[langSelect.value].pause||'Pause') : (TRANSLATIONS[langSelect.value].play||'Play');
if(running) loop();
});
resetBtn.addEventListener('click',()=>{snake=[{x:8,y:8}];dir={x:1,y:0};food=randomPos();score=0;updateScore();draw()});
speedInput.addEventListener('input',()=>{speed = Number(speedInput.value)});


let lastTime = 0;
function loop(ts){
if(!lastTime) lastTime = ts;
const elapsed = ts - lastTime;
if(elapsed > speed){ step(); lastTime = ts; }
requestAnimationFrame(loop);
}
draw(); requestAnimationFrame(loop);


</script>
</body>
</html>